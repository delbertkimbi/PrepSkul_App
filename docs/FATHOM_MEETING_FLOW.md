# Complete Automated Meeting Flow - PrepSkul with Fathom

## Overview

**All processes are AUTOMATIC** - No manual intervention required from meeting link generation to feedback delivery.

---

## Complete Automated Flow

### Phase 1: Session Booking & Payment

**1. Student/Parent Books Trial Session**
- ‚úÖ User selects tutor, subject, date, time, duration
- ‚úÖ System calculates trial fee (2000 XAF for 30min, 3500 XAF for 60min)
- ‚úÖ User enters phone number
- ‚úÖ **AUTOMATIC:** Payment initiated via Fapshi

**2. Payment Processing**
- ‚úÖ **AUTOMATIC:** Fapshi payment request sent
- ‚úÖ **AUTOMATIC:** Payment status polling (every 3 seconds, max 2 minutes)
- ‚úÖ **AUTOMATIC:** Payment confirmation received
- ‚úÖ **AUTOMATIC:** Trial session status updated to 'scheduled'

**Manual Step:** ‚ùå **NONE** - Fully automated

---

### Phase 2: Meeting Link & Calendar Setup

**3. Google Meet Link Generation**
- ‚úÖ **AUTOMATIC:** Google Calendar API creates calendar event
- ‚úÖ **AUTOMATIC:** Google Meet link auto-generated by Calendar API
- ‚úÖ **AUTOMATIC:** Meet link stored in database (`trial_sessions.meet_link`)

**4. Calendar Event Creation**
- ‚úÖ **AUTOMATIC:** Calendar event created with:
  - Title: "Trial Session: [Subject]"
  - Start time: Scheduled date/time
  - Duration: Session duration
  - Attendees:
    - Tutor email
    - Student/Parent email
    - `prepskul-va@prepskul.com` (PrepSkul Virtual Assistant)
- ‚úÖ **AUTOMATIC:** Calendar event ID stored in database
- ‚úÖ **AUTOMATIC:** Notifications sent to tutor and student

**Manual Step:** ‚ùå **NONE** - Fully automated

---

### Phase 3: Fathom Auto-Join & Recording

**5. Fathom Calendar Monitoring**
- ‚úÖ **AUTOMATIC:** Fathom monitors PrepSkul VA's Google Calendar
- ‚úÖ **AUTOMATIC:** When meeting time arrives, Fathom detects calendar event
- ‚úÖ **AUTOMATIC:** Fathom joins Google Meet as participant
- ‚úÖ **AUTOMATIC:** Fathom starts recording when meeting begins
- ‚úÖ **AUTOMATIC:** Fathom transcribes in real-time

**Manual Step:** ‚ùå **NONE** - Fully automated

**Note:** Fathom joins via calendar invite, so it works regardless of:
- User's device (mobile, desktop, tablet)
- User's location
- User's timezone (calendar handles this)

---

### Phase 4: Session Completion & Processing

**6. Meeting Ends**
- ‚úÖ **AUTOMATIC:** Fathom stops recording when meeting ends
- ‚úÖ **AUTOMATIC:** Fathom processes recording (transcription, summary, action items)
- ‚úÖ **AUTOMATIC:** Fathom generates:
  - Full transcript with speaker identification
  - AI-generated summary (markdown formatted)
  - Action items with assignees
  - Meeting insights

**7. Webhook Trigger**
- ‚úÖ **AUTOMATIC:** Fathom sends webhook to `https://app.prepskul.com/api/webhooks/fathom`
- ‚úÖ **AUTOMATIC:** Webhook payload includes:
  - `recording_id`
  - `meeting_title`
  - `calendar_invitees`
  - `url` (Fathom recording link)

**Manual Step:** ‚ùå **NONE** - Fully automated

---

### Phase 5: Data Processing & Storage

**8. Fetch Meeting Data**
- ‚úÖ **AUTOMATIC:** Webhook handler fetches summary from Fathom API
- ‚úÖ **AUTOMATIC:** Webhook handler fetches transcript from Fathom API
- ‚úÖ **AUTOMATIC:** Data stored in database:
  - `session_transcripts` table (transcript, summary, recording_id)
  - `session_summaries` table (key points, progress notes)

**9. Extract Action Items**
- ‚úÖ **AUTOMATIC:** Action items extracted from Fathom response
- ‚úÖ **AUTOMATIC:** Assignments created in `assignments` table
- ‚úÖ **AUTOMATIC:** Due dates calculated (default: next session or 7 days)
- ‚úÖ **AUTOMATIC:** Notifications sent to students for new assignments

**10. Admin Flag Detection**
- ‚úÖ **AUTOMATIC:** Transcript analyzed for irregular behavior:
  - Inappropriate language
  - Payment bypass attempts
  - External contact attempts
  - No-shows
  - Short sessions
  - Content violations
- ‚úÖ **AUTOMATIC:** Flags stored in `admin_flags` table
- ‚úÖ **AUTOMATIC:** Critical flags trigger admin notifications

**Manual Step:** ‚ùå **NONE** - Fully automated

---

### Phase 6: Distribution & Notifications

**11. Summary Distribution**
- ‚úÖ **AUTOMATIC:** Email sent to tutor:
  - Subject: "Session Summary: [Title]"
  - Content: Full summary, action items, student progress
- ‚úÖ **AUTOMATIC:** Email sent to student/parent:
  - Subject: "Your Session Summary: [Title]"
  - Content: Summary, assignments, next steps
- ‚úÖ **AUTOMATIC:** In-app notifications created:
  - Tutor notification: "Session Summary Ready"
  - Student notification: "Your Session Summary"
  - Parent notification (if applicable)

**12. Admin Notifications**
- ‚úÖ **AUTOMATIC:** Admin notifications for:
  - Critical flags (payment bypass, inappropriate language)
  - Session completion reports
  - Assignment creation summaries

**Manual Step:** ‚ùå **NONE** - Fully automated

---

## Complete Flow Diagram

```
1. User Books Session
   ‚Üì
2. Payment Processed (Fapshi)
   ‚Üì
3. Google Calendar Event Created (AUTOMATIC)
   ‚îú‚îÄ Meet Link Generated (AUTOMATIC)
   ‚îú‚îÄ PrepSkul VA Added as Attendee (AUTOMATIC)
   ‚îî‚îÄ Notifications Sent (AUTOMATIC)
   ‚Üì
4. Meeting Time Arrives
   ‚Üì
5. Fathom Joins Meeting (AUTOMATIC via Calendar)
   ‚îú‚îÄ Recording Starts (AUTOMATIC)
   ‚îî‚îÄ Transcription Begins (AUTOMATIC)
   ‚Üì
6. Meeting Ends
   ‚Üì
7. Fathom Processes Recording (AUTOMATIC)
   ‚îú‚îÄ Generates Summary (AUTOMATIC)
   ‚îú‚îÄ Extracts Action Items (AUTOMATIC)
   ‚îî‚îÄ Sends Webhook (AUTOMATIC)
   ‚Üì
8. Webhook Handler Processes (AUTOMATIC)
   ‚îú‚îÄ Fetches Summary & Transcript (AUTOMATIC)
   ‚îú‚îÄ Stores in Database (AUTOMATIC)
   ‚îú‚îÄ Creates Assignments (AUTOMATIC)
   ‚îú‚îÄ Analyzes for Flags (AUTOMATIC)
   ‚îî‚îÄ Sends Emails & Notifications (AUTOMATIC)
   ‚Üì
9. Users Receive Feedback (AUTOMATIC)
   ‚îú‚îÄ Tutor: Email + In-App Notification
   ‚îú‚îÄ Student: Email + In-App Notification
   ‚îú‚îÄ Parent: Email (if applicable)
   ‚îî‚îÄ Admin: Notification (if flags detected)
```

---

## Manual Processes: NONE ‚úÖ

**Everything is automated:**

1. ‚úÖ Meeting link generation ‚Üí **AUTOMATIC** (Google Calendar API)
2. ‚úÖ Calendar event creation ‚Üí **AUTOMATIC** (Server-side)
3. ‚úÖ PrepSkul VA joining ‚Üí **AUTOMATIC** (Fathom calendar monitoring)
4. ‚úÖ Recording ‚Üí **AUTOMATIC** (Fathom)
5. ‚úÖ Transcription ‚Üí **AUTOMATIC** (Fathom)
6. ‚úÖ Summary generation ‚Üí **AUTOMATIC** (Fathom AI)
7. ‚úÖ Action item extraction ‚Üí **AUTOMATIC** (Fathom AI)
8. ‚úÖ Assignment creation ‚Üí **AUTOMATIC** (Webhook handler)
9. ‚úÖ Flag detection ‚Üí **AUTOMATIC** (Transcript analysis)
10. ‚úÖ Email distribution ‚Üí **AUTOMATIC** (Email service)
11. ‚úÖ In-app notifications ‚Üí **AUTOMATIC** (Notification service)
12. ‚úÖ Admin alerts ‚Üí **AUTOMATIC** (Flag detection)

---

## Mobile User Experience

**Mobile users can fully participate:**

1. **Booking:** Mobile app or mobile web browser
2. **Payment:** Mobile money via Fapshi (works on mobile)
3. **Calendar:** Automatic (server-side, device-independent)
4. **Meeting Join:** Google Meet works on mobile browsers
5. **Fathom Join:** Automatic via calendar (device-independent)
6. **Feedback:** Email + in-app notifications (works on mobile)

**Key Point:** Since Fathom joins via calendar invite (not dependent on user's device), mobile users get the same experience as desktop users.

---

## Error Handling & Fallbacks

**Automatic error handling:**

1. **Payment Failure:**
   - Retry mechanism (3 attempts)
   - User notified automatically
   - Session status updated

2. **Fathom Join Failure:**
   - Admin notified
   - Session marked for review
   - Alternative recording triggered (if configured)

3. **Webhook Failure:**
   - Retry logic (exponential backoff)
   - Webhook events stored for replay
   - Manual trigger available for admins

4. **Email Delivery Failure:**
   - Retry mechanism
   - Fallback to in-app notification only
   - Admin notified of failures

---

## Summary

**‚úÖ 100% Automated Flow**
- Zero manual intervention required
- Works for all devices (mobile, desktop, tablet)
- Calendar-based joining (device-independent)
- Complete end-to-end automation from booking to feedback

**Manual Steps:** **NONE** - Everything happens automatically! üéâ

